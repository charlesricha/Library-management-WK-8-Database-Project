<!DOCTYPE html>
<html>
<head>
    <title>Library App</title>
</head>
<body>
    <h1>Welcome to the Library</h1>

    <h2>Books Available</h2>
    <ul id="book-list">
        </ul>
    <button id="show-books">Show Available Books</button>

    <h2>Borrow a Book</h2>
    <form id="borrow-form">
        <label for="user-id">User ID:</label>
        <input type="number" id="user-id" name="userId" required><br><br>

        <label for="book-id">Book ID:</label>
        <input type="number" id="book-id" name="bookId" required><br><br>

        <button type="submit">Borrow Book</button>
    </form>
    <div id="message"></div>

    <script>
        const bookList = document.getElementById('book-list');
        const showBooksButton = document.getElementById('show-books');
        const borrowForm = document.getElementById('borrow-form');
        const messageContainer = document.getElementById('message');

        // Function to fetch and display books
        function displayAvailableBooks() {
            fetch('/books')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(books => {
                    bookList.innerHTML = ''; // Clear previous list
                    books.forEach(book => {
                        const listItem = document.createElement('li');
                        listItem.textContent = `Title: ${book.Title}, ISBN: ${book.ISBN}, Publication Year: ${book.PublicationYear}, Book ID: ${book.BookID}`;
                        bookList.appendChild(listItem);
                    });
                })
                .catch(error => {
                    console.error('Error fetching books:', error);
                    messageContainer.textContent = 'Failed to load books. Please check the server.';
                });
        }

        // Event listener for the "Show Available Books" button
        showBooksButton.addEventListener('click', displayAvailableBooks);

        // Event listener for the "Borrow Book" form submission
        borrowForm.addEventListener('submit', (event) => {
            event.preventDefault(); // Prevent the default form submission

            const userId = document.getElementById('user-id').value;
            const bookId = document.getElementById('book-id').value;

            fetch('/borrow', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded', // Important for form data
                },
                body: `userId=${userId}&bookId=${bookId}`, //  Encode the data
            })
                .then(response => {
                    if (!response.ok) {
                         throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    messageContainer.textContent = data.message;
                    // Clear the form
                    borrowForm.reset();
                    // Optionally, refresh the book list after a successful borrow
                    displayAvailableBooks();
                })
                .catch(error => {
                    console.error('Error borrowing book:', error);
                    messageContainer.textContent = 'Failed to borrow book. Please check the server and try again.';
                });
        });
    </script>
</body>
</html>
